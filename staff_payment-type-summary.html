<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <title>Payment Type Summary - iChildren</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    /* ==========================================
       CSS VARIABLES
       ========================================== */
    :root {
      /* Primary Colors */
      --primary-color: #5DD5C0;
      --primary-light: #E8F9F6;
      
      /* Accent Colors */
      --accent-orange: #FF9D5C;
      --accent-red: #FF6B6B;
      --accent-blue: #4D96FF;
      --accent-yellow: #FFD93D;
      --accent-purple: #9D5CFF;
      
      /* Status Colors */
      --status-queue: #E3F2FD;
      --status-queue-text: #1976D2;
      --status-update: #F5F5F5;
      --status-update-text: #6B7280;
      
      /* Background Colors */
      --bg-dashboard: #F9F9F9;
      --bg-container: #FFFFFF;
      
      /* Text Colors */
      --text-primary: #2C3E50;
      --text-secondary: #7F8C8D;
      
      /* UI Colors */
      --border-color: #E0E0E0;
      --sidebar-active: #F2F2F2;
      --online-green: #4CAF50;
    }

    /* ==========================================
       GLOBAL RESET
       ========================================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      font-size: 11px;
      color: var(--text-primary);
      background: var(--bg-dashboard);
    }

    /* ==========================================
       LAYOUT
       ========================================== */
    .dashboard-container {
      display: flex;
      min-height: 100vh;
    }

    .main-content {
      margin-left: 180px;
      padding: 20px 30px 40px;
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* ==========================================
       SIDEBAR
       ========================================== */
    .sidebar {
      width: 180px;
      background: var(--bg-container);
      padding: 20px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      overflow-y: auto;
      z-index: 100;
    }

    .profile-section {
      text-align: center;
      margin-bottom: 25px;
    }

    .profile-avatar {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0 auto 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 28px;
      font-weight: 600;
    }

    .profile-name {
      font-size: 13px;
      font-weight: 500;
    }

    .nav-item {
      display: block;
      text-decoration: none;
      color: var(--text-secondary);
      padding: 10px 15px;
      margin-bottom: 5px;
      font-size: 12px;
      border-radius: 6px;
      transition: 0.2s;
      text-align: center;
      position: relative;
      cursor: pointer;
    }

    .nav-item:hover,
    .nav-item.active {
      background: var(--sidebar-active);
      color: var(--text-primary);
    }

    .nav-item.has-dropdown::after {
      content: '‚ñº';
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 8px;
      transition: 0.2s;
    }

    .nav-item.has-dropdown.open::after {
      transform: translateY(-50%) rotate(180deg);
    }

    .nav-dropdown {
      display: none;
      margin-top: 5px;
    }

    .nav-dropdown.open {
      display: block;
    }

    .nav-dropdown-item {
      display: block;
      text-decoration: none;
      padding: 8px 10px;
      font-size: 11px;
      color: var(--text-secondary);
      border-radius: 4px;
      margin-bottom: 3px;
      transition: 0.2s;
      text-align: center;
    }

    .nav-dropdown-item:hover,
    .nav-dropdown-item.active {
      background: var(--bg-dashboard);
      color: var(--text-primary);
    }

    /* ==========================================
       HEADER
       ========================================== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .searchbar {
      display: flex;
      align-items: center;
      gap: 8px;
      height: 40px;
      width: 320px;
      padding: 0 10px 0 12px;
      background: var(--bg-container);
      border: 1px solid var(--border-color);
      border-radius: 9999px;
      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.02);
      transition: 0.15s;
    }

    .searchbar:focus-within {
      border-color: #d0d7de;
      box-shadow: 0 0 0 4px var(--primary-light);
    }

    .searchbar input {
      flex: 1;
      border: 0;
      outline: 0;
      background: transparent;
      font-size: 12px;
    }

    .searchbar .icon-left,
    .searchbar .icon-right {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border: 0;
      background: transparent;
      color: var(--text-secondary);
      border-radius: 999px;
      cursor: pointer;
      transition: 0.15s;
    }

    .searchbar .icon-left:hover,
    .searchbar .icon-right:hover {
      background: var(--bg-dashboard);
      color: var(--text-primary);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .online-status {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      background: var(--online-green);
      border-radius: 50%;
    }

    .notification-bell {
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      transition: 0.2s;
    }

    .notification-bell:hover {
      transform: scale(1.1);
    }

    .logo-container {
      width: 35px;
      height: 35px;
      background: linear-gradient(135deg, #5DD5C0 0%, #4AC4B0 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 11px;
      font-weight: 700;
      cursor: pointer;
    }

    /* ==========================================
       PAGE TITLE
       ========================================== */
    .page-title-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
    }

    .page-title {
      font-size: 24px;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* ==========================================
       CHART CARD COMMON
       ========================================== */
    .chart-section {
      background: var(--bg-container);
      border-radius: 14px;
      padding: 20px 22px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      border: 1px solid var(--border-color);
    }

    .chart-section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }

    .chart-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

/* YEAR FILTER ‚Äì NEW DESIGN */
.year-filter {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  color: var(--text-secondary);
}

.year-filter svg {
  width: 14px;
  height: 14px;
  color: var(--text-secondary);
}

.year-label {
  font-weight: 500;
  color: var(--text-secondary);
}

/* DROPDOWN BUTTON-STYLE */
.year-filter select {
  padding: 6px 26px 6px 10px;
  border: 1px solid var(--border-color);
  border-radius: 6px;
  font-size: 11px;
  color: var(--text-primary);
  background: var(--bg-container);
  cursor: pointer;
  appearance: none;

  /* custom arrow */
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%237F8C8D' d='M6 8L2 4h8z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 6px center;
  min-width: 90px;
}

.year-filter select:focus {
  outline: none;
  box-shadow: 0 0 0 2px var(--primary-light);
  border-color: var(--primary-color);
}


    /* ==========================================
       OVERVIEW LAYOUT (cards left, donut right)
       ========================================== */
    .overview-layout {
      display: flex;
      gap: 200px;
      align-items: flex-start;
    }

    .overview-left {
      flex: 0 0 340px;
    }

    .overview-right {
      flex: 0 0 360px;
      display: flex;
      justify-content: center;
    }

    /* ==========================================
       PAYMENT CARDS
       ========================================== */
    .payment-cards-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      margin-bottom: 0;
    }

    .payment-card {
      background: var(--bg-container);
      border-radius: 12px;
      padding: 14px 16px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
      border: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
    }

    .payment-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      flex-shrink: 0;
    }

    .payment-details {
      flex: 1;
    }

    .payment-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .payment-subtitle {
      font-size: 10px;
      color: var(--text-secondary);
    }

    .payment-value-box {
      width: 80px;
      padding: 8px 10px;
      background: var(--bg-container);
      border: 2px solid var(--border-color);
      border-radius: 8px;
      text-align: center;
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
    }

    /* ==========================================
       DONUT CHART
       ========================================== */
    .donut-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 30px;
    }

    .donut-chart {
      width: 280px;
      height: 280px;
      position: relative;
    }

    .donut-legend {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .donut-legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
    }

    .donut-legend-color {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .donut-legend-label {
      flex: 1;
      color: var(--text-secondary);
    }

    .donut-legend-value {
      font-weight: 700;
      color: var(--text-primary);
    }

    /* ==========================================
       BAR CHART (inside same card)
       ========================================== */
    .bar-row {
      margin-top: 24px;
      padding-top: 20px;
      border-top: 1px solid #F3F4F6;
    }

    .bar-transparent {
      margin-top: 8px;
      padding: 16px 18px;
      border-radius: 12px;
      background: transparent;      /* transparent container */
      border: 1px solid #E5E7EB;    /* remove if you don't want outline */
    }

    .chart-container {
      width: 100%;
      height: 400px;
      position: relative;
    }

    .chart-legend {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-top: 16px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
    }

    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 3px;
    }

    /* ==========================================
       RESPONSIVE
       ========================================== */
    @media (max-width: 900px) {
      .overview-layout {
        flex-direction: column;
        gap: 24px;
      }

      .overview-right {
        flex: 1;
        justify-content: flex-start;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }

      .main-content {
        margin-left: 0;
      }

      .page-title-section {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .payment-cards-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="dashboard-container">
    <!-- ==========================================
         SIDEBAR
         ========================================== -->
    <aside class="sidebar">
      <div class="profile-section">
        <div class="profile-avatar">J</div>
        <div class="profile-name">Jenny</div>
      </div>

      <nav class="nav-menu">
        <a href="staff_maindashboard.html" class="nav-item">Home</a>
        <a href="staff_childprofile.html" class="nav-item">Child Profile</a>
        <a href="staff_calendar.html" class="nav-item">Calendar</a>
        <a href="staff_payment.html" class="nav-item">Payment</a>

        <div class="nav-item has-dropdown open" onclick="toggleDropdown(this)">
          Report
          <div class="nav-dropdown open">
            <a href="staff_appointment-summary.html" class="nav-dropdown-item">Appointment Summary</a>
            <a href="staff_payment-status-summary.html" class="nav-dropdown-item">Payment Status Summary</a>
            <a href="staff_payment-type-summary.html" class="nav-dropdown-item active">Payment Type Summary</a>
            <a href="staff_management-table.html" class="nav-dropdown-item">Management Table</a>
          </div>
        </div>

        <a href="logout" class="nav-item" style="margin-top:50px;">Log Out</a>
        <a href="staff_settings.html" class="nav-item">Settings</a>
      </nav>
    </aside>

    <!-- ==========================================
         MAIN CONTENT
         ========================================== -->
    <main class="main-content">
      <!-- Header -->
      <header class="header">
        <form class="searchbar" onsubmit="return false;">
          <button type="button" class="icon-left" aria-label="Search">
            <svg viewBox="0 0 24 24" width="18" height="18">
              <path d="M11 4a7 7 0 1 1-4.95 11.95l-2.6 2.6a1 1 0 0 1-1.4-1.42l2.6-2.6A7 7 0 0 1 11 4Zm0 2a5 5 0 1 0 0 10A5 5 0 0 0 11 6Z" fill="currentColor"/>
            </svg>
          </button>
          <input id="searchInput" placeholder="Search..." autocomplete="off"/>
          <button type="button" class="icon-right" aria-label="Open filters">
            <svg viewBox="0 0 24 24" width="18" height="18">
              <path d="M4 7h8a2 2 0 1 0 0-2H4a2 2 0 0 0 0 2Zm0 12h8a2 2 0 1 0 0-2H4a2 2 0 0 0 0 2Zm16-7h-8a2 2 0 1 0 0 2h8a2 2 0 1 0 0-2Z" fill="currentColor"/>
            </svg>
          </button>
        </form>

        <div class="header-right">
          <div class="online-status">
            <span class="status-dot"></span>
            <span>Online Status</span>
          </div>
          <div class="notification-bell" onclick="showNotifications()">üîî</div>
          <div class="logo-container" title="iChildren">iC</div>
        </div>
      </header>

      <!-- Page Title -->
      <div class="page-title-section">
        <h1 class="page-title">Payment Type Summary</h1>
      </div>

      <!-- ==========================================
           OVERVIEW + DONUT + BAR (all in one section)
           ========================================== -->
      <section class="chart-section">
        <!-- Header with filter -->
      <div class="chart-section-header">
        <div class="chart-title">Overview by Payment Type</div>
        <div class="year-filter">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
          </svg>
          <span class="year-label">Year</span>
          <select id="yearSelect"></select>
        </div>
      </div>


        <!-- FIRST ROW: cards + donut -->
        <div class="overview-layout">
          <!-- LEFT: cards -->
          <div class="overview-left">
            <div class="payment-cards-grid">
              <div class="payment-card">
                <div class="payment-icon">üíµ</div>
                <div class="payment-details">
                  <div class="payment-label">Cash Payment</div>
                  <div class="payment-subtitle">Total sessions paid in cash</div>
                </div>
                <div class="payment-value-box" id="cashValue">0</div>
              </div>

              <div class="payment-card">
                <div class="payment-icon">üì±</div>
                <div class="payment-details">
                  <div class="payment-label">Digital Payment</div>
                  <div class="payment-subtitle">GCash / bank transfers</div>
                </div>
                <div class="payment-value-box" id="digitalValue">0</div>
              </div>

              <div class="payment-card">
                <div class="payment-icon">üèõÔ∏è</div>
                <div class="payment-details">
                  <div class="payment-label">DSWD Paid</div>
                </div>
                <div class="payment-value-box" id="dswdPaid">0</div>
              </div>

              <div class="payment-card">
                <div class="payment-icon">üèõÔ∏è</div>
                <div class="payment-details">
                  <div class="payment-label">Unpaid</div>
                </div>
                <div class="payment-value-box" id="dswdUnpaid">0</div>
              </div>
            </div>
          </div>

          <!-- RIGHT: donut -->
          <div class="overview-right">
            <div class="donut-container">
              <div class="donut-chart">
                <canvas id="paymentDonutChart"></canvas>
              </div>
              <div class="donut-legend">
                <div class="donut-legend-item">
                  <div class="donut-legend-color" style="background: #48BB78;"></div>
                  <span class="donut-legend-label">Cash</span>
                  <span class="donut-legend-value" id="legendCash">0%</span>
                </div>
                <div class="donut-legend-item">
                  <div class="donut-legend-color" style="background: #2563EB;"></div>
                  <span class="donut-legend-label">DSWD Paid</span>
                  <span class="donut-legend-value" id="legendDSWDPaid">0%</span>
                </div>
                <div class="donut-legend-item">
                  <div class="donut-legend-color" style="background: #C084FC;"></div>
                  <span class="donut-legend-label">Digital</span>
                  <span class="donut-legend-value" id="legendDigital">0%</span>
                </div>
                <div class="donut-legend-item">
                  <div class="donut-legend-color" style="background: #FDE047;"></div>
                  <span class="donut-legend-label">DSWD Unpaid</span>
                  <span class="donut-legend-value" id="legendUnpaid">0%</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- SECOND ROW: bar chart (transparent container) -->
        <div class="bar-row">
          <div class="chart-section-header">
            <div class="chart-title">Payment Type by Month</div>
          </div>

          <div class="bar-transparent">
            <div class="chart-container">
              <canvas id="paymentBarChart"></canvas>
            </div>

            <div class="chart-legend">
              <div class="legend-item">
                <div class="legend-color" style="background: #48BB78;"></div>
                <span>Cash</span>
              </div>
              <div class="legend-item">
                <div class="legend-color" style="background: #2563EB;"></div>
                <span>DSWD Paid</span>
              </div>
              <div class="legend-item">
                <div class="legend-color" style="background: #FDE047;"></div>
                <span>DSWD Unpaid</span>
              </div>
              <div class="legend-item">
                <div class="legend-color" style="background: #F59E0B;"></div>
                <span>Unpaid</span>
              </div>
              <div class="legend-item">
                <div class="legend-color" style="background: #C084FC;"></div>
                <span>Digital Payment</span>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    /* ==========================================
       DATA
       ========================================== */
    const paymentData = {
      2025: {
        cash: 29,
        digital: 17,
        dswdPaid: 7,
        dswdUnpaid: 15,
        monthly: {
          January:   { cash: 4, dswdPaid: 0, dswdUnpaid: 2, unpaid: 3, digital: 2 },
          February:  { cash: 3, dswdPaid: 0, dswdUnpaid: 2, unpaid: 3, digital: 3 },
          March:     { cash: 2, dswdPaid: 1, dswdUnpaid: 1, unpaid: 3, digital: 2 },
          April:     { cash: 3, dswdPaid: 1, dswdUnpaid: 2, unpaid: 1, digital: 2 },
          May:       { cash: 5, dswdPaid: 1, dswdUnpaid: 2, unpaid: 3, digital: 5 },
          June:      { cash: 2, dswdPaid: 1, dswdUnpaid: 1, unpaid: 0, digital: 3 },
          July:      { cash: 0, dswdPaid: 0, dswdUnpaid: 0, unpaid: 4, digital: 0 },
          August:    { cash: 0, dswdPaid: 0, dswdUnpaid: 0, unpaid: 1, digital: 0 },
          September: { cash: 0, dswdPaid: 0, dswdUnpaid: 0, unpaid: 0, digital: 0 },
          October:   { cash: 0, dswdPaid: 0, dswdUnpaid: 0, unpaid: 0, digital: 0 },
          November:  { cash: 0, dswdPaid: 0, dswdUnpaid: 0, unpaid: 0, digital: 0 },
          December:  { cash: 0, dswdPaid: 0, dswdUnpaid: 0, unpaid: 0, digital: 0 }
        }
      },
      2024: {
        cash: 25,
        digital: 15,
        dswdPaid: 5,
        dswdUnpaid: 12,
        monthly: {
          January:   { cash: 3, dswdPaid: 0, dswdUnpaid: 1, unpaid: 2, digital: 2 },
          February:  { cash: 2, dswdPaid: 1, dswdUnpaid: 1, unpaid: 1, digital: 1 },
          March:     { cash: 3, dswdPaid: 0, dswdUnpaid: 1, unpaid: 2, digital: 2 },
          April:     { cash: 2, dswdPaid: 1, dswdUnpaid: 1, unpaid: 1, digital: 1 },
          May:       { cash: 3, dswdPaid: 0, dswdUnpaid: 2, unpaid: 2, digital: 2 },
          June:      { cash: 2, dswdPaid: 1, dswdUnpaid: 1, unpaid: 1, digital: 2 },
          July:      { cash: 3, dswdPaid: 0, dswdUnpaid: 1, unpaid: 1, digital: 1 },
          August:    { cash: 2, dswdPaid: 1, dswdUnpaid: 1, unpaid: 2, digital: 1 },
          September: { cash: 2, dswdPaid: 0, dswdUnpaid: 1, unpaid: 1, digital: 1 },
          October:   { cash: 1, dswdPaid: 1, dswdUnpaid: 1, unpaid: 0, digital: 1 },
          November:  { cash: 1, dswdPaid: 0, dswdUnpaid: 1, unpaid: 0, digital: 1 },
          December:  { cash: 1, dswdPaid: 0, dswdUnpaid: 0, unpaid: 0, digital: 0 }
        }
      }
    };

    const MONTH_NAMES = [
      'January','February','March','April','May','June',
      'July','August','September','October','November','December'
    ];

    /* ==========================================
       HELPERS
       ========================================== */
    function buildEmptyYearData() {
      const monthly = {};
      MONTH_NAMES.forEach(m => {
        monthly[m] = { cash: 0, dswdPaid: 0, dswdUnpaid: 0, unpaid: 0, digital: 0 };
      });
      return {
        cash: 0,
        digital: 0,
        dswdPaid: 0,
        dswdUnpaid: 0,
        monthly
      };
    }

    function getYearData(year) {
      const y = Number(year);
      if (paymentData[y]) return paymentData[y];
      return buildEmptyYearData();
    }

    /* ==========================================
       CHARTS
       ========================================== */
    let donutChart = null;
    let barChart = null;

    function updateDisplay(year) {
      const data = getYearData(year);

      // Update card values
      document.getElementById('cashValue').textContent = data.cash;
      document.getElementById('digitalValue').textContent = data.digital;
      document.getElementById('dswdPaid').textContent = data.dswdPaid;
      document.getElementById('dswdUnpaid').textContent = data.dswdUnpaid;

      // Calculate percentages for donut chart
      const total = data.cash + data.digital + data.dswdPaid + data.dswdUnpaid;
      let cashPercent = 0, digitalPercent = 0, dswdPaidPercent = 0, dswdUnpaidPercent = 0;
      if (total > 0) {
        cashPercent       = ((data.cash      / total) * 100).toFixed(1);
        digitalPercent    = ((data.digital   / total) * 100).toFixed(1);
        dswdPaidPercent   = ((data.dswdPaid  / total) * 100).toFixed(1);
        dswdUnpaidPercent = ((data.dswdUnpaid/ total) * 100).toFixed(1);
      }

      document.getElementById('legendCash').textContent       = cashPercent + '%';
      document.getElementById('legendDigital').textContent    = digitalPercent + '%';
      document.getElementById('legendDSWDPaid').textContent   = dswdPaidPercent + '%';
      document.getElementById('legendUnpaid').textContent     = dswdUnpaidPercent + '%';

      updateDonutChart(data);
      updateBarChart(data.monthly);
    }

    function updateDonutChart(data) {
      const ctx = document.getElementById('paymentDonutChart').getContext('2d');
      
      if (donutChart) donutChart.destroy();

      donutChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Cash', 'DSWD Paid', 'Digital', 'DSWD Unpaid'],
          datasets: [{
            data: [data.cash, data.dswdPaid, data.digital, data.dswdUnpaid],
            backgroundColor: ['#48BB78', '#2563EB', '#C084FC', '#FDE047'],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgba(0,0,0,0.8)',
              titleFont: { size: 13 },
              bodyFont: { size: 12 },
              padding: 12,
              cornerRadius: 8,
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.parsed || 0;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : '0.0';
                  return `${label}: ${value} (${percentage}%)`;
                }
              }
            }
          },
          cutout: '65%'
        }
      });
    }

    function updateBarChart(monthlyData) {
      const ctx = document.getElementById('paymentBarChart').getContext('2d');
      
      if (barChart) barChart.destroy();

      const months = MONTH_NAMES;
      const cashData       = months.map(m => monthlyData[m].cash);
      const dswdPaidData   = months.map(m => monthlyData[m].dswdPaid);
      const dswdUnpaidData = months.map(m => monthlyData[m].dswdUnpaid);
      const unpaidData     = months.map(m => monthlyData[m].unpaid);
      const digitalData    = months.map(m => monthlyData[m].digital);

      barChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: months,
          datasets: [
            { label: 'Cash',           data: cashData,       backgroundColor: '#48BB78', borderRadius: 4, barThickness: 12 },
            { label: 'DSWD Paid',      data: dswdPaidData,   backgroundColor: '#2563EB', borderRadius: 4, barThickness: 12 },
            { label: 'DSWD Unpaid',    data: dswdUnpaidData, backgroundColor: '#FDE047', borderRadius: 4, barThickness: 12 },
            { label: 'Unpaid',         data: unpaidData,     backgroundColor: '#F59E0B', borderRadius: 4, barThickness: 12 },
            { label: 'Digital Payment',data: digitalData,    backgroundColor: '#C084FC', borderRadius: 4, barThickness: 12 }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgba(0,0,0,0.8)',
              titleFont: { size: 12 },
              bodyFont: { size: 11 },
              padding: 10,
              cornerRadius: 6
            }
          },
          scales: {
            x: {
              grid: { display: false },
              ticks: { font: { size: 11 } }
            },
            y: {
              beginAtZero: true,
              grid: { color: 'rgba(0,0,0,0.05)' },
              ticks: { stepSize: 1, font: { size: 10 } }
            }
          }
        }
      });
    }

    /* ==========================================
       EVENT HANDLERS
       ========================================== */
    function toggleDropdown(element) {
      element.classList.toggle('open');
      const dropdown = element.querySelector('.nav-dropdown');
      if (dropdown) dropdown.classList.toggle('open');
    }

    function showNotifications() {
      alert('No new notifications');
    }

    /* ==========================================
       DOCUMENT READY
       ========================================== */
    document.addEventListener('DOMContentLoaded', () => {
      const yearSelect = document.getElementById('yearSelect');
      const currentYear = new Date().getFullYear();

      for (let y = 2000; y <= currentYear; y++) {
        const opt = document.createElement('option');
        opt.value = y;
        opt.textContent = y;
        yearSelect.appendChild(opt);
      }

      const availableYears = Object.keys(paymentData).map(Number).sort((a, b) => a - b);
      let defaultYear = currentYear;
      if (!paymentData[currentYear]) {
        defaultYear = availableYears[availableYears.length - 1];
      }

      yearSelect.value = defaultYear;
      updateDisplay(defaultYear);

      yearSelect.addEventListener('change', (e) => {
        updateDisplay(e.target.value);
      });
    });
  </script>
</body>
</html>
